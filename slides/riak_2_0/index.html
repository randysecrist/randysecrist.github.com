<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Introduction to Riak Search</title>

		<meta name="description" content="A Distributed Company">
		<meta name="author" content="Randy Secrist">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="/assets/reveal-2.6.1/css/reveal.min.css">
		<link rel="stylesheet" href="/assets/reveal-2.6.1/css/theme/solarized.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="/assets/reveal-2.6.1/lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="/assets/reveal-2.6.1/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="/assets/reveal-2.6.1/lib/js/html5shiv.js"></script>
		<![endif]-->

		<script type="text/javascript">
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-23047862-1']);
		  _gaq.push(['_trackPageview']);

		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		</script>
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Riak 2.0</h1>
					<h3>Introduction</h3>
					<p>
						<small>
							by <a href="http://randy.secrist.io">Randy Secrist</a> / <a href="http://twitter.com/randysecrist">@randysecrist</a><br/>
						</small>
					</p>
					<aside class="notes">
						KV is awesome, but make development easier
					</aside>
				</section>

				<section>
					<h2>New Features</h2>
					<ul>
						<li>Better Search</li>
						<li>Data Types</li>
						<div class="fragment">
							<li>Strong Consistency</li>
							<li>Security</li>
							<li>Better Config Management</li>
					    </div>
					</ul>
					<aside class="notes">
						KV, roll your own index, link walking, map reduce, search 1.0, 2i
						to
						TODAY; Search 2.0
					</aside>
				</section>

				<section>
					<!-- TODO:  Add 2.0 Arch Slide -->
					<section>
						<h2>Search</h2>
						<ul>
							<li>Document Indexing</li>
							<li>Schemas</li>
							<li>Simple Index Search</li>
							<div class="fragment">
								<li>Full Text Search</li>
								<li>Facet Queries</li>
								<li>Highlighting</li>
							</div>
						</ul>
						<aside class="notes">
							Anyone who does pure KV, 'wrestles' with Search.
							  - (Hybrids are common).
							  - (Use the right tools for the job, don't have impedance mismatch).
							Insert Architecture Diagram
							Documents do not need to be flat to index.
							Documents can be any type, but less dev time using
							XML / JSON.
						</aside>
					</section>

					<section>
						<h2>Yokozuna - High</h2>
						<ul>
							<li>Write it like Riak</li>
							<li>Query it like Solr</li>
						</ul>
						<p>&nbsp;</p>
						<p>
							<small>
								<a href="http://zinascii.com/2013/solr-distributed-search-and-the-stale-check.html#6">Z References</a><br/>
								<a href="http://zinascii.com/yokozuna-cls/slides/yokozuna-demo.html#/">Commit Log Search</a>
							</small>
						</p>
					</section>

					<section>
						<h2>Yokozuna - Lower</h2>
						<ul>
							<li>Distributed Solr</li>
							<li>Active Anti Entropy</li>
							<li>HTTP or Protocol Buffers</li>
						</ul>
						<aside class="notes">
							Can query solr nodes directly, but may not have complete harvest (partition coverage).
							Use the riak search 2.0 (yokozuna provided) endpoint instead.
							Basho / Riak client libaries have low level support for Search 2.0.
						</aside>
					</section>

					<section>
						<h2>Yokozuna - Low</h2>
						<ul>
							<li><a href="https://github.com/basho/riak-ruby-client">Ruby</a></li>
							<li><a href="https://github.com/basho/riak-python-client">Python</a></li>
							<li><a href="https://github.com/basho/riak-java-client">Java</a></li>
						</ul>
						<aside class="notes">
							Can query solr nodes directly, but may not have complete harvest (partition coverage).
							Use the riak search 2.0 (yokozuna provided) endpoint instead.
							Basho / Riak client libaries have low level support for Search 2.0.
							For lazy developers like me, quite a bit of low level setup to use.
						</aside>
					</section>
				</section>

				<section>
					<!-- TODO:  Show RJ on Arch Slide -->
					<section>
						<h2>Riak JSON</h2>
						<ul>
                                                  <li>
								<a href="https://github.com/basho-labs/riak_json">Open Source @ Basho Labs</a>
							</li>
							<li>Layered Above Riak Search 2.0</li>
							<li>HTTP API</li>
						</ul>

						<div>
							<pre><code data-trim contenteditable>
git clone https://github.com/basho-labs/riak_json
							</code></pre>
						</div>

						<aside class="notes">
							Ease YZ setup - (lets make it easy for devs)
							More collection / document oriented using JSON.
							Open Source, in Basho Labs
							Higher level, developer friendly API on top of Search 2.0
							Java, Ruby, Python and Node.js client libraries.
						</aside>
					</section>

					<section>
						<h2>Riak JSON Client Libraries</h2>
						<div>
							<small>
							  <a href="https://github.com/dmitrizagidulin/nrj">Node.js</a>
						    </small>
							<pre><code data-trim contenteditable>
git clone https://github.com/dmitrizagidulin/nrj
							</code></pre>
						</div>
						<div>
							<small>
							  <a href="https://github.com/basho-labs/riak_json_python_client">Python</a>
						    </small>
							<pre><code data-trim contenteditable>
git clone https://github.com/basho-labs/riak_json_python_client
							</code></pre>
						</div>
						<div>
							<small>
							  <a href="https://github.com/basho-labs/riak_json_ruby_client">Ruby</a>
						    </small>
							<pre><code data-trim contenteditable>
git clone https://github.com/basho-labs/riak_json_ruby_client
							</code></pre>
						</div>
						<div>
							<small>
							  <a href="https://github.com/dmitrizagidulin/riagent">Riagent (RiakJson for Rails)</a>
						    </small>
							<pre><code data-trim contenteditable>
git clone https://github.com/dmitrizagidulin/riagent
							</code></pre>
						</div>
						<div>
							<small>
							  <a href="https://github.com/basho-labs/riak_json_java_client">Java</a>
						    </small>
							<pre><code data-trim contenteditable>
git clone https://github.com/basho-labs/riak_json_java_client
							</code></pre>
						</div>
					</section>
				</section>

				<section>
					<section>
						<h2>Getting Riak JSON</h2>
					</section>

					<section>
						<h2>Build from Source</h2>
						<div>
							<pre><code data-trim contenteditable>
git clone https://github.com/basho/riak.git
git checkout ack-riak-json
make rel
make devrel
							</code></pre>
						</div>

						<aside class="notes">
							I will build you a custom package.
							If you use windows, use vagrant vm + c# client
						</aside>
					</section>

					<!-- TODO -->
					<section>
						<h2>Vagrant VM w/ Virtual Box</h2>

						<aside class="notes">
							Use http://ps-tools.data.riakcs.net:8080/riak_2.0.0pre15-9d332123-riak_json_0.0.1_amd64.deb
							wget, 'sudo dpkg -i riak_2.0.0pre15-9d332123-riak_json_0.0.1_amd64.deb '
						</aside>
					</section>

					<section>
						<h2>Riak Configuration</h2>
						<p>
							etc/riak.conf
						</p>
						<pre><code data-trim contenteditable>
search = on
riak_json_http = on
						</code></pre>
					</section>

					<section>
						<h2>Start Riak</h2>
						<pre><code data-trim contenteditable>
ulimit -n 4096
bin/riak start
bin/riak ping
						</code></pre>
					</section>
				</section>

				<!-- TODO:  push jar file to github repo -->
				<section>
					<section>
						<h2>Java / Scala</h2>
                                                <iframe width="100%" height="500" src="http://jsfiddle.net/randysecrist/czhZN/2/embedded/html%2Cjs/presentation/"></iframe>
					</section>

					<section>
						<h2>Import</h2>
						<div><small>Java</small>
							<pre><code data-trim contenteditable class="java">
import com.basho.riak.json.*;
							</code></pre>
						</div>
						<div><small>Scala</small>
							<pre><code data-trim contenteditable class="scala">
import com.basho.riak.json._
import com.basho.riak.json.Field.Type._

import scala.beans.BeanProperty
import com.fasterxml.jackson.annotation.JsonIgnore;
							</code></pre>
						</div>
					</section>

					<section>
						<h2>Instantiate</h2>
						<div><small>Java</small>
							<pre><code data-trim contenteditable class="java">
Client client = new Client("localhost", 10018);
client.createCollection("test_collection");
							</code></pre>
						</div>
						<div><small>Scala</small>
							<pre><code data-trim contenteditable class="scala">
val client = new Client("localhost", 10018)
client.createCollection("test_collection")
							</code></pre>
						</div>
					</section>

					<section>
						<h2>Define Class</h2>
						<div><small>Scala</small>
							<pre><code data-trim contenteditable class="scala">
class MySquare (l:Int, w:Int) extends Document {
  def this() =  this(0, 0)
  @BeanProperty var key: String = _
  @BeanProperty var length: Int = l
  @BeanProperty var width: Int = w

  /* don't serialize this tuple */
  @JsonIgnore def getSize = Tuple2(length, width)
}
  							</code></pre>
						</div>
					</section>

					<section>
						<h2>Define Schema</h2>
						<div><small>Scala</small>
							<pre><code data-trim contenteditable class="scala">
val schema = new Schema.Builder()
  .addField(new Field("length", INTEGER).setRequired(true))
  .addField(new Field("width", INTEGER).setRequired(true))
  .addField(new Field("owner", STRING))
  .build()
  							</code></pre>
						</div>
					</section>

					<section>
						<h2>Associate Schema</h2>
						<div><small>Scala</small>
							<pre><code data-trim contenteditable class="scala">
collection.setSchema(schema)
  							</code></pre>
						</div>
					</section>

					<section>
						<h2>Getting Data In</h2>
						<div><small>Scala</small>
							<pre><code data-trim contenteditable class="scala">
val large_square = new MySquare(1024, 768)
val normal_square = new MySquare(640, 480)
collection.insert(large_square)
collection.insert(normal_square)
  							</code></pre>
						</div>
					</section>

					<section>
						<h2>Getting Data Out</h2>
						<div><small>Scala</small>
							<pre><code data-trim contenteditable class="scala">
// By Key
val result = collection.findByKey("9tT49FHJoQImObmPYgVPRcB56T2", classOf[MySquare])
result.getLength() => 1024
  							</code></pre>
 						</div>
					</section>

					<section>
						<h2>Getting Data Out</h2>
						<div><small>Scala</small>
							<pre><code data-trim contenteditable class="scala">
// Find One
val q_string = "{\"length\": {\"$gt\": 300}}"
val query = new Query(q_string, classOf[MySquare]);
val single_result = collection.findOne(query)
  							</code></pre>
							<pre><code data-trim contenteditable class="scala">
// All the Things!
val many_results = collection.findAll(query)

// documents are a java Collection
many_results.getDocuments().size() => 2

// info about the result set
many_results.numPages(); => 1 -- total pages in result set
many_results.getPage(); => 0 -- current page (zero-indexed)
many_results.perPage(); => results per page, defaults to 100

// extract into a more malable scala list if needed:
many_results.getDocuments.toArray(
  new Array[MySquare](many_results.getDocuments.size)
)
  							</code></pre>
 						</div>
					</section>
				</section>

				<section>
					<section>
						<h2>Python</h2>
						<pre><code data-trim contenteditable>
git clone http://github.com/basho/riak_json_python_client
cd riak_json_python_client
python setup.py install
  						</code></pre>
					</section>

					<section>
						<h2>Import</h2>
						<div>
							<pre><code data-trim contenteditable class="python">
from riakjson.client import Client, Connection
from riakjson.schema import Schema
							</code></pre>
						</div>
					</section>

					<section>
						<h2>Instantiate</h2>
						<div>
							<pre><code data-trim contenteditable class="python">
client = Client(Connection(host='127.0.0.1', port=10018))

# Create or use an existing collection named 'customers'
customers = client.customers
							</code></pre>
						</div>
					</section>

					<section>
						<h2>Define Schema</h2>
						<div>
							<pre><code data-trim contenteditable class="python">
customer_schema = Schema()
	.text('name')
	.text('Address')
	.text('City')
	.number('Age')
	.geo('Location').build()
							</code></pre>
						</div>
						<aside class="notes">
							customer_schema = Schema().text('name').text('Address').text('City').number('Age').geo('Location').build()
						</aside>
					</section>

					<section>
						<h2>Associate Schema</h2>
						<div>
							<pre><code data-trim contenteditable class="python">
customers.set_schema(customer_schema)
							</code></pre>
						</div>
					</section>

					<section>
						<h2>Getting Data In</h2>
						<div>
							<pre><code data-trim contenteditable class="python">
# No key - key generated by RiakJson
customer = {'name': 'Json Argo',
	'Address': '123 Fake Street',
	'City': 'Ancient',
	'State': 'Greece',
	'Age': 23}

customer_key = customers.insert(customer)
# '/TgFKK4uUZKSpyXkMGGQUMhcZ8TQ'
							</code></pre>

							<pre><code data-trim contenteditable class="python">
# With a defined key
customer2 = {'name': 'Dan Gerr',
	'Address': '1000 Hoover Drive',
	'City': 'Ferrytown',
	'State': 'WV',
	'Age': 33}
customer2_key = 'cust_key_12345'
customers.insert(customer2, customer2_key)
# 'cust_key_12345'
							</code></pre>
						</div>
						<aside class="notes">
							customer = {'name': 'Json Argo', 'Address': '123 Fake Street', 'City': 'Ancient', 'State': 'Greece', 'Age': 23}
							customer_key = customers.insert(customer)
							customer2 = {'name': 'Dan Gerr', 'Address': '1000 Hoover Drive', 'City': 'Ferrytown','State': 'WV', 'Age': 33}
							customer2_key = 'cust_key_12345'
						</aside>
					</section>

					<section>
						<h2>Getting Data Out</h2>
						<div class="python">
							<pre><code data-trim contenteditable>
# GET by key
customer_record = customers.get(customer_key)
## u'{"Age":23,"City":"Ancient","State":"Greece","name":"Json Argo","Address":"123 Fake Street"}'
							</code></pre>

							<pre><code data-trim contenteditable class="python">
# SEARCH - Exact field match, single record
query = {'name': 'Json Argo'}

customers.find_one(query)
## {u'City': u'Ancient', u'name': u'Json Argo', u'Age': 23, u'State': u'Greece', u'Address': u'123 Fake Street', u'_id': u'TgFKK4uUZKSpyXkMGGQUMhcZ8TQ'}
							</code></pre>

							<pre><code data-trim contenteditable class="python">
## SEARCH - All users whose name begins with Json, field names are case sensitive
query = {'name': 'Json*'}

result = customers.find(query)
# &lt;riakjson.result.Result object at 0x10e884910&gt;

# iterate results
for item in result.objects():
	print item

## {u'City': u'Ancient', u'name': u'Json Argo', u'Age': 23, u'State': u'Greece', u'Address': u'123 Fake Street', u'_id': u'TgFKK4uUZKSpyXkMGGQUMhcZ8TQ'}
							</code></pre>
						</div>	
					</section>
				</section>

				<section>
					<h2>Riak JSON Operators</h2>
					<ul>
						<li>AND</li>
						<li>OR</li>
						<li>Not Equal ($ne)</li>
						<li>Greater Than ($gt)</li>
						<li>Greater Than Equal($gte)</li>
						<li>Less Than ($lt)</li>
						<li>Less Than Equal($lte)</li>
						<li>Between</li>
						<li>Regex</li>
						<li>Exists</li>
					</ul>
					<aside class="notes">
						% Mongo expects slashes and .*'s to be added
						https://github.com/basho-labs/riak_json/blob/6ed8f218031feb54c76de0b19812c93b529285bc/src/rj_query.erl
					</aside>
				</section>

				<section>
					<h1>THE END</h1>
					<small><a href="http://basho.com">basho.com</a></small><br/>
					<small><a href="http://randy.secrist.io">randy.secrist.io<a></small>
				</section>

			</div>

		</div>

		<script src="/assets/reveal-2.6.1/lib/js/head.min.js"></script>
		<script src="/assets/reveal-2.6.1/js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: '/assets/reveal-2.6.1/lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: '/assets/reveal-2.6.1/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '/assets/reveal-2.6.1/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '/assets/reveal-2.6.1/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: '/assets/reveal-2.6.1/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: '/assets/reveal-2.6.1/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
